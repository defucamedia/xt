/*
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
 GNU Affero General Public License version 3 {@link http://www.gnu.org/licenses/agpl-3.0.html}
*/
if(typeof window.console!=="object"||typeof window.console.emulated==="undefined"){if(typeof window.console!=="object"||!(typeof window.console.log==="function"||typeof window.console.log==="object")){window.console={};window.console.log=window.console.debug=window.console.warn=window.console.trace=function(){};window.console.error=function(){for(var c="An error has occured. More information will be available in the console log.",a=0;a<arguments.length;++a){if(typeof arguments[a]!=="string")break;
c+="\n"+arguments[a]}if(typeof Error!=="undefined")throw Error(c);else throw c;}}else{if(typeof window.console.debug==="undefined")window.console.debug=function(){for(var c=["console.debug:"],a=0;a<arguments.length;a++)c.push(arguments[a]);window.console.log.apply(window.console,c)};if(typeof window.console.warn==="undefined")window.console.warn=function(){for(var c=["console.warn:"],a=0;a<arguments.length;a++)c.push(arguments[a]);window.console.log.apply(window.console,c)};if(typeof window.console.error===
"undefined")window.console.error=function(){for(var c=["console.error"],a=0;a<arguments.length;a++)c.push(arguments[a]);window.console.log.apply(window.console,c)};if(typeof window.console.trace==="undefined")window.console.trace=function(){window.console.error.apply(window.console,["console.trace does not exist"])}}window.console.emulated=true}String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};
String.prototype.strip=String.prototype.strip||function(c,a){c=String(c);var b=this;if(c.length){a||0||(c=c.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));b=b.replace(eval("/^"+c+"+|"+c+"+$/g"),"")}return String(b)};String.prototype.stripLeft=String.prototype.stripLeft||function(c,a){c=String(c);var b=this;if(c.length){a||0||(c=c.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));b=b.replace(eval("/^"+c+"+/g"),"")}return String(b)};
String.prototype.stripRight=String.prototype.stripRight||function(c,a){c=String(c);var b=this;if(c.length){a||0||(c=c.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));b=b.replace(eval("/"+c+"+$/g"),"")}return String(b)};String.prototype.toInt=String.prototype.toInt||function(){return parseInt(this,10)};String.prototype.wrap=String.prototype.wrap||function(c,a){return c+this+a};
String.prototype.wrapSelection=String.prototype.wrapSelection||function(c,a,b,d){if(typeof b==="undefined"||b===null)b=this.length;if(typeof d==="undefined"||d===null)d=this.length;return this.substring(0,b)+c+this.substring(b,d)+a+this.substring(d)};String.prototype.toSlug=String.prototype.toSlug||function(){return this.toLowerCase().replace(/[\s_]/g,"-").replace(/[^-a-z0-9]/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")};
String.prototype.queryStringToJSON=String.prototype.queryStringToJSON||function(){var c=String(this);c=c.substring(c.indexOf("?")+1);c=c.replace(/\+/g,"%20");if(c.substring(0,1)==="{"&&c.substring(c.length-1)==="}")return eval(decodeURIComponent(c));c=c.split(/\&(amp\;)?/);for(var a={},b=0,d=c.length;b<d;++b){var e=c[b]||null;if(e!==null){e=e.split("=");if(e!==null){var f=e[0]||null;if(f!==null)if(typeof e[1]!=="undefined"){e=e[1];f=decodeURIComponent(f);e=decodeURIComponent(e);try{e=eval(e)}catch(g){}var h=
f.split(".");if(h.length===1)a[f]=e;else{var j="",i="";$.each(h,function(n,k){j+='["'+k.replace(/"/g,'\\"')+'"]';jsonCLOSUREGLOBAL=a;i="if ( typeof jsonCLOSUREGLOBAL"+j+' === "undefined" ) jsonCLOSUREGLOBAL'+j+" = {}";eval(i);a=jsonCLOSUREGLOBAL;delete jsonCLOSUREGLOBAL});jsonCLOSUREGLOBAL=a;valueCLOSUREGLOBAL=e;i="jsonCLOSUREGLOBAL"+j+" = valueCLOSUREGLOBAL";eval(i);a=jsonCLOSUREGLOBAL;delete jsonCLOSUREGLOBAL;delete valueCLOSUREGLOBAL}}}}}return a};
(function(c){c.fn.binder=c.fn.binder||function(a,b,d){var e=c(this);if(d)e.bind(a,b,d);else{d=b;e.bind(a,d)}return e};c.fn.once=c.fn.once||function(a,b,d){var e=c(this);if(d){e.unbind(a,d);e.bind(a,b,d)}else{d=b;e.unbind(a,d);e.bind(a,d)}return e};c.fn.enter=c.fn.enter||function(a,b){return c(this).binder("enter",a,b)};c.event.special.enter=c.event.special.enter||{setup:function(){c(this).bind("keypress",c.event.special.enter.handler)},teardown:function(){c(this).unbind("keypress",c.event.special.enter.handler)},
handler:function(a){c(this);if(a.keyCode===13){a.type="enter";c.event.handle.apply(this,[a]);return true}}};c.fn.cancel=c.fn.cancel||function(a,b){return c(this).binder("cancel",a,b)};c.event.special.cancel=c.event.special.cancel||{setup:function(){c(this).bind("keyup",c.event.special.cancel.handler)},teardown:function(){c(this).unbind("keyup",c.event.special.cancel.handler)},handler:function(a){c(this);var b=a.keyCode===27;if((typeof a.DOM_VK_ESCAPE==="undefined"?false:a.DOM_VK_ESCAPE)||b){a.type=
"cancel";c.event.handle.apply(this,[a]);return true}}};c.fn.lastclick=c.fn.lastclick||function(a,b){return c(this).binder("lastclick",a,b)};c.event.special.lastclick=c.event.special.lastclick||{setup:function(){c(this).bind("click",c.event.special.lastclick.handler)},teardown:function(){c(this).unbind("click",c.event.special.lastclick.handler)},handler:function(a){var b=function(){var d=c(this),e=d.data("lastclick-timeout")||false;e&&clearTimeout(e);e=false;d.data("lastclick-timeout",e)};(function(d){var e=
this;b.call(e);var f=c(e);f.data("lastclick-clicks",(f.data("lastclick-clicks")||0)+1);var g=setTimeout(function(){var h=f.data("lastclick-clicks");b.apply(e,[d]);f.data("lastclick-clicks",0);d.type="lastclick";c.event.handle.apply(e,[d,h])},500);f.data("lastclick-timeout",g)}).apply(this,[a])}};c.fn.firstclick=c.fn.firstclick||function(a,b){return c(this).binder("firstclick",a,b)};c.event.special.firstclick=c.event.special.firstclick||{setup:function(){c(this).bind("click",c.event.special.firstclick.handler)},
teardown:function(){c(this).unbind("click",c.event.special.firstclick.handler)},handler:function(a){var b=function(){var d=c(this),e=d.data("firstclick-timeout")||false;e&&clearTimeout(e);e=false;d.data("firstclick-timeout",e)};(function(d){var e=this;b.call(e);var f=c(e);f.data("firstclick-clicks",(f.data("firstclick-clicks")||0)+1);if(f.data("firstclick-clicks")===1){d.type="firstclick";c.event.handle.apply(e,[d])}var g=setTimeout(function(){b.apply(e,[d]);f.data("firstclick-clicks",0)},500);f.data("firstclick-timeout",
g)}).apply(this,[a])}};c.fn.singleclick=c.fn.singleclick||function(a,b){return c(this).binder("singleclick",a,b)};c.event.special.singleclick=c.event.special.singleclick||{setup:function(){c(this).bind("click",c.event.special.singleclick.handler)},teardown:function(){c(this).unbind("click",c.event.special.singleclick.handler)},handler:function(a){var b=function(){var d=c(this),e=d.data("singleclick-timeout")||false;e&&clearTimeout(e);e=false;d.data("singleclick-timeout",e)};(function(d){var e=this;
b.call(e);var f=c(e);f.data("singleclick-clicks",(f.data("singleclick-clicks")||0)+1);var g=setTimeout(function(){var h=f.data("singleclick-clicks");b.apply(e,[d]);f.data("singleclick-clicks",0);if(h===1){d.type="singleclick";c.event.handle.apply(e,[d])}},500);f.data("singleclick-timeout",g)}).apply(this,[a])}}})(jQuery);
(function(c){c.fn.opacityFix=c.fn.opacityFix||function(){var a=c(this),b=a.css("background-color");if(b&&b!=="rgba(0, 0, 0, 0)")return this;for(var d=a;d.inDOM();){d=d.parent();if((b=d.css("background-color"))&&b!=="rgba(0, 0, 0, 0)"){a.css("background-color",b);break}}return this};c.fn.parentsAndSelf=c.fn.parentsAndSelf||function(a){return c(this).parents(a).andSelf().filter(a)};c.fn.findAndSelf=c.fn.findAndSelf||function(a){return c(this).find(a).andSelf().filter(a)};c.fn.firstInput=c.fn.firstInput||
function(){return c(this).findAndSelf(":input").filter(":first")};c.fn.choose=c.fn.choose||function(a){var b=c(this);if(typeof a==="undefined")a=b.val();else if(b.val()!==a)return this;switch(true){case this.is("option"):b.parents("select:first").choose(a);break;case b.is(":checkbox"):b.attr("checked",true);break;case b.is(":radio"):b.attr("checked",true);break;case b.is("select"):b.val(a);break;default:break}return this};c.fn.unchoose=c.fn.unchoose||function(){var a=c(this);switch(true){case a.is("option"):a.parents(":select:first").unchoose();
break;case a.is(":checkbox"):a.attr("checked",false);break;case a.is(":radio"):a.attr("checked",false);break;case a.is("select"):a.val(a.find("option:first").val());break;default:break}return this};c.fn.wouldSubmit=c.fn.wouldSubmit||function(){var a=c(this).findAndSelf(":input"),b=true;if(!a.length||!(a.attr("name")||0)||a.is(":radio,:checkbox")&&!a.is(":selected,:checked"))b=false;return b};c.fn.values=c.fn.values||function(){var a={};c(this).findAndSelf(":input").each(function(){var b=c(this),d=
b.attr("name")||null,e=b.val();if(!b.wouldSubmit())return true;if(d.indexOf("[]")!==-1){if(typeof a[d]==="undefined")a[d]=[];a[d].push(e)}else a[d]=e});return a};c.fn.submitForm=c.fn.submitForm||function(){var a=c(this);a.parentsAndSelf("form:first").trigger("submit");return a};c.fn.inDOM=c.fn.inDOM||function(){var a=c(this).parent().parent();return a.size()&&(a.height()||a.width())};c.fn.valWrap=c.fn.valWrap||function(a,b){var d=c(this);return d.val(d.val().wrap(a,b))};c.fn.valWrapSelection=c.fn.valWrapSelection||
function(a,b,d,e){var f=c(this),g=f.get(0);a=a||"";b=b||"";if(d||e)f.val(f.val().wrapSelection(a,b,d,e));else{d=g.selectionStart;e=g.selectionEnd;if(document.selection){g.focus();d=document.selection.createRange();d.text=a+d.text+b}else{var h=g.scrollTop;f.val(f.val().wrapSelection(a,b,d,e));g.focus();g.selectionStart=d+a.length;g.selectionEnd=e+a.length;g.scrollTop=h}}return f};c.fn.giveFocus=c.fn.giveFocus||function(){c(this).findAndSelf(":input:visible:first").focus();return this};c.fn.highlight=
c.fn.highlight||function(a){return c(this).effect("highlight",{},a||3E3)};c.fn.htmlAndSelf=c.fn.htmlAndSelf||function(){return c(this).attr("outerHTML")};c.fn.preventDefault=c.fn.preventDefault||function(){return c(this).click(function(a){a.preventDefault();return false})};c.fn.attemptTypeChangeTo=c.fn.attemptTypeChangeTo||function(a){var b=c(this),d=false,e=b.get(0),f=e.type;if(a===f)d=true;else if(b.is("input"))if(!c.browser.msie){e.type=a;if(e.type!==f)d=true}return d}})(jQuery);
(function(c){c.prepareObject=c.prepareObject||function(a,b){var d={};c.extend(d,a||{});c.intercept(true,d,b);var e=arguments;e[0]=e[1]="$.prepareObject.skipValue";c.each(e,function(f,g){if(g==="$.prepareObject.skipValue")return true;c.intercept(true,d,g)});return d};c.intercept=c.intercept||function(){var a=arguments,b,d=false,e=false;if(typeof a[0]==="boolean"){d=a[0];a[0]="$.intercept.skipValue";if(typeof a[1]==="boolean"){e=a[1];a[1]="$.intercept.skipValue";if(e)b={};else{b=a[2];a[2]="$.intercept.skipValue"}}else{b=
a[1];a[1]="$.intercept.skipValue"}}else{b=a[0];a[0]="$.intercept.skipValue"}var f={};c.each(b,function(g){f[g]=true});d?c.each(a,function(g,h){if(h==="$.intercept.skipValue")return true;c.each(h,function(j,i){if(typeof f[j]==="undefined")return true;if(typeof i==="object"&&!(i.test||0))c.extend(b[j],i||{});else b[j]=i})}):c.each(a,function(g,h){c.each(h,function(j,i){if(typeof f[j]==="undefined")return true;if(typeof i==="object"&&!(i.test||0))c.intercept(true,b[j],i);else b[j]=i})});return b}})(jQuery);
(function(c){function a(d){return typeof d=="object"?d:{top:d,left:d}}var b=c.scrollTo=function(d,e,f){c(window).scrollTo(d,e,f)};b.defaults={axis:"xy",duration:parseFloat(c.fn.jquery)>=1.3?0:1};b.window=function(){return c(window)._scrollable()};c.fn._scrollable=function(){return this.map(function(){if(!(!this.nodeName||c.inArray(this.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1))return this;var d=(this.contentWindow||this).document||this.ownerDocument||this;return c.browser.safari||
d.compatMode=="BackCompat"?d.body:d.documentElement})};c.fn.scrollTo=function(d,e,f){if(typeof e=="object"){f=e;e=0}if(typeof f=="function")f={onAfter:f};if(d=="max")d=9E9;f=c.extend({},b.defaults,f);e=e||f.speed||f.duration;f.queue=f.queue&&f.axis.length>1;if(f.queue)e/=2;f.offset=a(f.offset);f.over=a(f.over);return this._scrollable().each(function(){function g(m){j.animate(k,e,f.easing,m&&function(){m.call(this,d,f)})}var h=this,j=c(h),i=d,n,k={},l=j.is("html,body");switch(typeof i){case "number":case "string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(i)){i=
a(i);break}i=c(i,this);case "object":if(i.is||i.style)n=(i=c(i)).offset()}c.each(f.axis.split(""),function(m,r){var o=r=="x"?"Left":"Top",p=o.toLowerCase(),q="scroll"+o,s=h[q],t=b.max(h,r);if(n){k[q]=n[p]+(l?0:s-j.offset()[p]);if(f.margin){k[q]-=parseInt(i.css("margin"+o))||0;k[q]-=parseInt(i.css("border"+o+"Width"))||0}k[q]+=f.offset[p]||0;if(f.over[p])k[q]+=i[r=="x"?"width":"height"]()*f.over[p]}else{o=i[p];k[q]=o.slice&&o.slice(-1)=="%"?parseFloat(o)/100*t:o}if(/^\d+$/.test(k[q]))k[q]=k[q]<=0?
0:Math.min(k[q],t);if(!m&&f.queue){s!=k[q]&&g(f.onAfterFirst);delete k[q]}});g(f.onAfter)}).end()};b.max=function(d,e){var f=e=="x"?"Width":"Height",g="scroll"+f;if(!c(d).is("html,body"))return d[g]-c(d)[f.toLowerCase()]();f="client"+f;var h=d.ownerDocument.documentElement,j=d.ownerDocument.body;return Math.max(h[g],j[g])-Math.min(h[f],j[f])};c.fn.ScrollTo=function(d){for(var e=c(this),f=e.parent(),g=false;f.length===1&&!f.is("body");){var h=f.get(0);if(f.css("overflow")!=="visible"&&h.scrollHeight!==
h.clientHeight){g=true;break}f=f.parent()}if(g){f.scrollTo(e,d);f.ScrollTo(d)}else c.scrollTo(e);return e}})(jQuery);
(function(c){if(c.History)window.console.warn("$.History has already been defined...");else{c.History={options:{debug:false},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},extractHash:function(a){return a.replace(/^[^#]*#/,"").replace(/^#+|#+$/,"")},getState:function(){return c.History.state},setState:function(a){var b=c.History;a=b.extractHash(a);b.state=a;return b.state},getHash:function(){return c.History.extractHash(window.location.hash||location.hash)},setHash:function(a){a=
c.History.extractHash(a);if(typeof window.location.hash!=="undefined"){if(window.location.hash!==a)window.location.hash=a}else if(location.hash!==a)location.hash=a;return a},go:function(a){var b=c.History;a=b.extractHash(a);var d=b.getHash(),e=b.getState();if(a!==d)b.setHash(a);else{a!==e&&b.setState(a);b.trigger()}return true},hashchange:function(){var a=c.History,b=a.getHash();a.go(b);return true},bind:function(a,b){var d=c.History;if(b){if(typeof d.handlers.specific[a]==="undefined")d.handlers.specific[a]=
[];d.handlers.specific[a].push(b)}else{b=a;d.handlers.generic.push(b)}return true},trigger:function(a){var b=c.History;if(typeof a==="undefined")a=b.getState();var d,e,f,g;if(typeof b.handlers.specific[a]!=="undefined"){g=b.handlers.specific[a];d=0;for(e=g.length;d<e;++d){f=g[d];f(a)}}g=b.handlers.generic;d=0;for(e=g.length;d<e;++d){f=g[d];f(a)}return true},construct:function(){var a=c.History;c(document).ready(function(){a.domReady()});return true},configure:function(a){var b=c.History;b.options=
c.extend(b.options,a);return true},domReadied:false,domReady:function(){var a=c.History;if(!a.domRedied){a.domRedied=true;a.$window=c(window);a.$window.bind("hashchange",this.hashchange);setTimeout(a.hashchangeLoader,200);return true}},nativeSupport:function(a){a=a||c.browser;var b=a.version,d=parseInt(b,10),e=b.split(/[^0-9]/g);b=parseInt(e[0],10);var f=parseInt(e[1],10);e=parseInt(e[2],10);var g=false;if((a.msie||0)&&d>=8)g=true;else if((a.webkit||0)&&d>=528)g=true;else if(a.mozilla)if(b>1)g=true;
else{if(b===1)if(f>9)g=true;else if(f===9)if(e>=2)g=true}else if(a.opera)if(b>10)g=true;else if(b===10)if(f>=60)g=true;return g},hashchangeLoader:function(){var a=c.History;if(a.nativeSupport())a.getHash()&&a.$window.trigger("hashchange");else{var b;if(c.browser.msie){a.$iframe=c('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];a.$iframe.contentWindow.document.open();a.$iframe.contentWindow.document.close();var d=false;b=function(){var e=a.getHash(),
f=a.getState(),g=a.extractHash(a.$iframe.contentWindow.document.location.hash);if(f!==e){if(!d){a.$iframe.contentWindow.document.open();a.$iframe.contentWindow.document.close();a.$iframe.contentWindow.document.location.hash=e}d=false;a.$window.trigger("hashchange")}else if(f!==g){d=true;a.setHash(g)}}}else b=function(){var e=a.getHash();a.getState()!==e&&a.$window.trigger("hashchange")};setInterval(b,200)}return true}};c.History.construct()}})(jQuery);
(function(c){c(document.body).addClass("js");if(c.Ajaxy)window.console.warn("$.Ajaxy has already been defined...");else{c.Ajaxy={options:{root_url:"",base_url:"",relative_url:"",no_log_class:"ajaxy-no_log",redirect:false,relative_as_base:true,support_text:true,analytics:true,auto_ajaxify:true,auto_ajaxify_documentReady:true,auto_sparkle_documentReady:true,add_sparkle_extension:true,scrollto_options:{duration:400,easing:"swing"},track_all_anchors:false,track_all_internal_links:false,debug:true,Controllers:{}},
defaults:{Controller:{selector:null,matches:null,controller:null,response:null,request:null,error:null},Action:{propagate:true,action:null,state:null,State:null,controller:null,Controller:null,forward:function(){window.console.error("Ajaxy.Action.forward: Forward never defined.",[this,arguments]);window.console.trace()},trigger:function(){window.console.error("Ajaxy.Action.trigger: Trigger never defined.",[this,arguments]);window.console.trace()},stopPropagation:function(){this.propagate=false},preventDefault:function(){this.propagate=
false},documentReady:function(a){return c.Ajaxy.stateCompleted(this.State,a)}},State:{mode:null,form:false,state:"",hash:"",anchor:"",querystring:"",controller:null,Request:{url:null,data:{}},Response:{callback:null,data:{}},Error:{callback:null,data:{}},User:{data:{}}}},constructed:false,Controllers:{},States:{},currentState:{},ajaxQueue:[],data:{},redirected:false,ensureString:function(a){var b="";switch(typeof a){case "number":case "string":b=String(a);break;default:b=""}return b},extractRelativeUrl:function(a){var b=
c.Ajaxy;a=b.ensureString(a);a=a.stripLeft(b.options.root_url).stripLeft(b.options.base_url);if(a==="/")a="";return a},extractState:function(a){return c.Ajaxy.extractRelativeUrl(a)},extractHash:function(a){a=c.Ajaxy.extractState(a);if((a=a.match(/^([^#?]*)/)||"")&&a.length||false===2)a=a[1]||"";return a},extractAnchor:function(a){a=c.Ajaxy.extractState(a);var b=a.replace(/[^#]+#/g,"#").match(/#+([^#\?]*)/)||"";if(b&&b.length||false===2)b=b[1]||"";if(b===a)b="";if(!b)if((b=a.match(/anchor=([a-zA-Z0-9-_]+)/)||
"")&&b.length||false===2)b=b[1]||"";return b},extractQuerystring:function(a){a=c.Ajaxy.extractState(a);if((a=a.match(/\?(.*)$/)||"")&&a.length||false===2)a=a[1]||"";return a},bind:function(a,b){var d=c.Ajaxy;if(typeof b==="undefined"&&typeof a==="object"){c.each(a,d.bind);return true}else if(typeof b==="function")b={response:b};else if(typeof b!=="object"){window.console.error("Ajaxy.bind: Unknown option type",[this,arguments]);window.console.trace();return false}if(typeof d.getController(a,false)===
"undefined")d.storeController(c.prepareObject(d.defaults.Controller,{controller:a},b));else{window.console.error("Ajaxy.bind: Controller already bound.",[this,arguments]);window.console.trace();return false}if(d.options.auto_ajaxify){d.ajaxifyController(a);return true}return true},trigger:function(a,b,d){var e=c.Ajaxy;e.options.debug&&window.console.debug("Ajaxy.trigger: ",[this,arguments]);var f=true;if(!a){window.console.warn("Ajaxy.trigger: No controller was passed, reset to _generic.",[this,arguments]);
a="_generic"}var g=e.getController(a),h=e.getControllerAction(a,b,false),j=e.getState(d,true);d=j.state||undefined;if(typeof g==="undefined"){window.console.error("Ajaxy.trigger: Controller does not exist",[this,arguments]);window.console.trace();a!=="_generic"&&e.trigger("_generic","error",j);return false}if(typeof h==="undefined"){window.console.error("Ajaxy.trigger: No Controller Action",[this,arguments]);window.console.trace();a!=="_generic"&&e.trigger("_generic","error",j);return false}g=c.extend(true,
{},e.defaults.Action,{action:b,controller:a,Controller:g,state:d,State:j});g.forward=g.trigger=function(i,n,k){e.options.debug&&window.console.debug("Ajaxy.Action.trigger:",[this,arguments]);i=i||a;n=n||b;k=k||d;e.trigger(i,n,k);return true};h.apply(g,[]);if(g.propagate===false)f=false;f&&a!=="_generic"&&g.forward("_generic");return true},get:function(a){var b=c.Ajaxy;if(typeof b.data[a]!=="undefined")return b.data[a]},set:function(a,b){var d=c.Ajaxy;if(typeof b==="undefined")typeof a==="object"&&
d.data.extend(true,a);else d.data[a]=b},refresh:function(){return c.Ajaxy.go(c.History.getHash())},go:function(a){var b=c.Ajaxy,d=c.History;b.options.debug&&window.console.debug("Ajaxy.go:",[this,arguments]);if(typeof a==="string")a={url:a};var e=b.getState(false,true);c.extend(true,e,a);if(!(e.state||0)&&(e.url||0))e.state=b.extractState(e.url);b.rebuildState(e);if(e.anchor===e.state||e.anchor===e.hash)e.anchor="";var f=(e.querystring||"").replace(/anchor=([a-zA-Z0-9-_]+)/g,"");if(!(e.hash||0)&&
!f&&(e.anchor||0)){e.hash=b.currentState.hash||"";e.querystring=f;b.rebuildState(e)}if(!e.state||!e.hash&&!f){window.console.warn("Ajaxy.go: No state or (hash and querystring)",[this,arguments],[e]);return false}delete f;if(e.mode)e.mode=e.form?"silent":"default";b.storeState(e);switch(e.mode){case "silent":b.stateChange(e.state);break;case "default":default:d.go(e.state);break}return true},getControllerAction:function(a,b,d){var e=undefined,f=c.Ajaxy.getController(a,false);if(typeof f==="undefined"){if(d!==
false){window.console.error("Ajaxy.getControllerAction: Controller does not exist",[this,arguments]);window.console.trace()}}else{var g=typeof(f[b]||undefined);if(g==="function"||g==="object")e=f[b];else if(d!==false){window.console.error("Ajaxy.getControllerAction: Controller Action does not exist",[this,arguments]);window.console.trace()}}return e},storeController:function(a){var b=c.Ajaxy,d=true;if(typeof(a||undefined)==="object"&&typeof a.controller==="string")d=b.Controllers[a.controller]=a;
else{window.console.error("Ajaxy.getController: Unkown Controller Format",[this,arguments]);window.console.trace();d=false}return d},getController:function(a,b){var d=c.Ajaxy,e=undefined,f=typeof(a||undefined);if((f==="number"||f==="string")&&typeof d.Controllers[a]!=="undefined")e=d.Controllers[a];else if(f==="object"&&typeof a.controller==="string")e=d.getController(a.controller,b);else if(b)e=c.extend(true,{},d.defaults.Controller);else if(b!==false){window.console.error("Ajaxy.getController: Controller does not exist",
[this,arguments]);window.console.trace()}return e},rebuildState:function(a){var b=c.Ajaxy,d=b.extractState(a.state),e=b.ensureString(a.hash)||b.extractHash(d),f=b.ensureString(a.anchor)||b.extractAnchor(d);b=b.ensureString(a.querystring)||b.extractQuerystring(d);a.state=e;if(f){d=b.queryStringToJSON();d.anchor=f;b=unescape(c.param(d));delete d}if(b)a.state+="?"+b;a.hash=e;a.anchor=f;a.querystring=b;return a},storeState:function(a){var b=c.Ajaxy,d=true;d=typeof(a||undefined);b.rebuildState(a);if(d===
"object"&&typeof a.state==="string")d=b.States[a.state]=a;else{window.console.error("Ajaxy.storeState: Unkown State Format",[this,arguments]);window.console.trace();d=false}return d},getState:function(a,b){var d=c.Ajaxy;a=d.extractState((a||{}).state||a);var e=undefined,f=typeof(a||undefined);if((f==="number"||f==="string")&&typeof d.States[a]!=="undefined")e=d.States[a];else if(b)e=d.createState(a);else if(b!==false){window.console.error("Ajaxy.getState: State does not exist",[this,arguments]);window.console.trace()}d.rebuildState(e);
return e},createState:function(a){var b=c.Ajaxy;a=b.extractState((a||{}).state||a);State=c.extend(true,{},b.defaults.State,{state:a});b.rebuildState(State);return State},track:function(a){var b=c.Ajaxy;if(typeof pageTracker!=="undefined"){var d=b.options.base_url+(a||"?");b.options.debug&&window.console.debug("Ajaxy.track",[this,arguments],[d]);pageTracker._trackPageview(d)}return true},matches:function(a,b){var d=c.Ajaxy,e=false;switch(typeof a){case "function":case "object":if(a.test){e=a.test(b);
break}case "array":c.each(a,function(f,g){if(e=d.matches(g,b))return false});break;case "number":case "string":e=String(a)===b;break}return e},match:function(a){var b=c.Ajaxy,d=false;c.each(b.Controllers,function(e,f){if(b.matches(f.matches||false,a)){d=e;return false}});return d},stateCompleted:function(a,b){var d=c.Ajaxy,e=d.options.auto_ajaxify_documentReady;(b||{}).length||0||(b=c("body"));if(d.options.auto_sparkle_documentReady&&c.Sparkle){if(d.options.add_sparkle_extension)e=false;b.sparkle()}e&&
b.ajaxify();if(e=a.anchor||false){a.anchor=false;c(".target").removeClass("target");c("#"+e).addClass("target").ScrollTo(d.options.scrollto_options)}return true},request:function(a){var b=c.Ajaxy,d=c.History;b.options.debug&&window.console.debug("Ajaxy.request:",[this,arguments]);var e=false,f=b.getState(a,true);if(b.redirected!==false)b.redirected=false;else{var g=(b.currentState.querystring||"").replace(/anchor=([a-zA-Z0-9-_]+)/g,""),h=f.querystring.replace(/anchor=([a-zA-Z0-9-_]+)/g,"");if((b.currentState.state||
0)&&b.currentState.hash===f.hash&&g===h&&!(f.form||b.currentState.form)){if(b.currentState.anchor!==f.anchor){b.options.debug&&window.console.debug("Ajaxy.request: There has only been an anchor change",[this,arguments],[b.currentState,f,a]);b.stateCompleted(f)}b.currentState=f;b.options.debug&&window.console.debug("Ajaxy.request: There has been no considerable change",[this,arguments],[b.currentState,f,a]);return true}delete g;delete h;b.ajaxQueue.push(a);if(b.ajaxQueue.length!==1)return false;b.options.analytics&&
b.track(a);b.currentState=f;g=f.controller||b.match(a)||undefined;f.controller=g;f.Request.url=f.Request.url||b.options.root_url+b.options.base_url+(a||"?");b.storeState(f);b.trigger(g,"request");g={data:f.Request.data,url:f.Request.url,type:"post",success:function(l){b.options.debug&&window.console.debug("Ajaxy.request.success:",[this,arguments]);l=c.extend(true,{},b.defaults.State.Response.data,l);l.Ajaxy=l.Ajaxy||{};if(l.Ajaxy.redirected){var m=b.extractState(l.Ajaxy.redirected.to);b.redirected=
{status:true,from:a,to:m};d.go(m)}b.ajaxQueue.shift();if((m=b.ajaxQueue.pop())&&m!==a){b.ajaxQueue=[];b.stateChange(m);return false}f.Response.data=l;f.Error.data={};m=l.controller||f.controller||null;if(m===null){m="_generic";window.console.warn("Ajaxy.request.success.controller: The controller was unable to be determined, defaulted to _generic.",[this,arguments],[l.controller,f.controller])}if(f.Response.callback)if(f.Response.callback.apply(f,arguments)||m==="callback")return true;return b.trigger(m,
"response",f)},error:function(l,m,r,o){b.options.debug&&window.console.debug("Ajaxy.request.error:",[this,arguments]);o||(o={responseText:l.responseText.trim()||false});b.ajaxQueue.shift();var p=b.ajaxQueue.pop();if(p&&p!==a){b.ajaxQueue=[];b.stateChange(p);return false}f.Request.XMLHttpRequest=l;f.Response.data=o;f.Error.data={};p=o.controller||f.controller||null;if(p===null){p="_generic";window.console.warn("Ajaxy.request.error.controller: The controller was unable to be determined, defaulted to _generic.",
[this,arguments],[o.controller,f.controller])}if(f.Error.callback)if(f.Error.callback.apply(f,arguments)||p==="callback")return true;return b.trigger(p,"error",f)},complete:function(l){b.options.debug&&window.console.debug("Ajaxy.request.complete:",[this,arguments]);f.Request.XMLHttpRequest=l}};if(f.form){var j=c(f.form);if(j.attr("enctype")==="multipart/form-data"){e="ajaxy_form_iframe_"+Math.floor(Math.random()*99999);var i=c('<iframe style="display:none" src="about:blank" id="'+e+'" name="'+e+
'" >').appendTo("body").hide(),n=c('<input type="hidden" name="ajax" value="true"/>').appendTo(j),k=c('<input type="hidden" name="Ajaxy[form]" value="true"/>').appendTo(j);i.bind("load",function(){if((this.document||this.currentDocument||this.contentWindow.document).location.href==="about:blank")return true;var l=i.contents().find(".response").val(),m=false;try{m=c.parseJSON(l)}catch(r){window.console.error("Ajaxy.request.form: Invalid Response.",[this,arguments],[l])}m?request.success(m):request.error(m);
j.removeAttr("target");i.remove();n.remove();k.remove()});j.attr("target",e);j.submit();h=j.values();g.data=c.extend(true,g.data,h||{});e=true}else{h=j.values();g.data=c.extend(true,g.data,h||{})}}h=true;f.Request=g;e||(h=b.ajax(g));return h}},htmlCompat:function(a){return String(a).replace(/<\!DOCTYPE[^>]*>/i,"").replace(/<(html|head|body|title|meta)/gi,'<div id="ajaxy-$1"').replace(/<\/(html|head|body|title|meta)/gi,"</div")},ajax:function(a){var b=c.Ajaxy;b.options.debug&&window.console.debug("Ajaxy.ajax:",
[this,arguments]);var d={};d.success=a.success||function(){b.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.success:",[this,arguments]);c(".error").empty()};d.error=a.error||function(f,g,h){b.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.error:",[this,arguments]);c(".error").html(h)};d.complete=a.complete||function(){b.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.complete:",[this,arguments])};delete a.success;delete a.error;delete a.complete;var e={type:"post",
dataType:b.options.support_text?"text":"json"};c.extend(true,e,a);e.success=function(f,g){b.options.debug&&window.console.debug("Ajaxy.ajax.request.success:",[this,arguments]);var h={};if(typeof f!=="object"&&b.options.support_text&&f)try{h=c.parseJSON(f)}catch(j){h=b.htmlCompat(f);var i=c(h),n=i.find("#ajaxy-head"),k=i.find("#ajaxy-body"),l=i.find("#ajaxy-title");i=i.find("#ajaxy-controller");l=l.length?l.text():"";n=n.length?n.htmlAndSelf():"";var m=k.length?k.htmlAndSelf():"";k=k.length?k.html():
h;h={controller:i.length?i.text().trim():null,responseText:f,html:h,title:l,head:n,body:m,content:k}}else h=f;b.options.debug&&window.console.debug("Ajaxy.ajax.success:",[this,arguments]);if(typeof h.controller==="undefined"&&(typeof h.success!=="undefined"&&!h.success||typeof h.error!=="undefined"&&h.error))return d.error.apply(this,[null,g,h.error||true,h]);return d.success.apply(this,[h,g])};e.error=function(f,g,h){b.options.debug&&window.console.debug("Ajaxy.ajax.request.error:",[this,arguments]);
var j=f.responseText||false;if(j)j=j.trim();j||(j=false);var i={error:h||true,responseText:j};if(j)try{i=c.parseJSON(j)}catch(n){}finally{return this.success.apply(this,[i,g])}return d.error.apply(this,[f,g,h,i])};return c.ajax(e)},stateChange:function(a){c.Ajaxy.request(a)},configure:function(a){var b=c.Ajaxy,d=c.History;a=a||{};var e=a.Controllers||a.controllers||a;b.options=c.extend(true,b.options,a.options||a);b.bind(e);b.options.root_url=(b.options.root_url||document.location.protocol.toString()+
"//"+document.location.hostname.toString()).replace(/\/+$/,"")+"/";b.options.base_url=b.options.base_url||"";b.options.relative_url=b.extractState(b.options.relative_url||document.location.pathname.toString());if(b.options.relative_as_base)if(b.options.base_url.length===0){b.options.base_url=b.options.relative_url;b.options.relative_url=""}b.options.root_url=b.options.root_url.replace(/\/+$/,"");b.options.base_url=b.options.base_url.replace(/\/+$/,"");b.options.relative_url=b.extractRelativeUrl(b.options.relative_url);
if(b.options.root_url==="/")b.options.root_url="";if(b.options.base_url==="/")b.options.base_url="";if(b.options.relative_url==="/")b.options.relative_url="";b.options.debug&&window.console.debug("Ajaxy.configure:",[this,arguments]);if(b.options.redirect&&b.options.relative_url&&b.options.relative_url!==null){b=b.options.root_url+b.options.base_url+"#"+b.options.relative_url;if(d=d.getHash())b+="?anchor="+d;document.location=b}return true},construct:function(){var a=c.Ajaxy,b=c.History;if(!a.constructed){a.constructed=
true;b.bind(function(d){return a.stateChange(d)});c.fn.ajaxify=a.ajaxify;c.fn.ajaxy=a.ajaxify;c(function(){a.domReady();b.domReady()});return true}},domReady:function(){c.Sparkle&&c.Sparkle.addExtension("ajaxy",function(){c(this).ajaxify()});return true},ajaxify:function(a){var b=c.Ajaxy,d=c(this);a=c.extend({complete:true},a);d.is("form,a")&&d.addClass("ajaxy");if(a.complete){c.each(b.Controllers,function(f){b.ajaxifyController(f)});if(b.options.track_all_internal_links){a=d.findAndSelf("a[href^=/],a[href^=./]");
if(b.options.root_url){var e=c("a[href^="+b.options.root_url+"]");a=a.add(e);delete e}a=a.filter(":not(.ajaxy,.no-ajaxy)").addClass("ajaxy");delete a}b.options.track_all_anchors&&d.findAndSelf("a[href^=#]:not(.ajaxy,.no-ajaxy)").addClass("ajaxy")}d.findAndSelf("a.ajaxy:not(.ajaxy-has)").addClass("ajaxy-has").once("click",b.ajaxify_helpers.a);d.findAndSelf("form.ajaxy:not(.ajaxy-has)").addClass("ajaxy-has").once("submit",b.ajaxify_helpers.form);return d},ajaxifyController:function(a){var b=c.Ajaxy.getController(a);
if(b&&(b.selector||0))c(function(){c(b.selector).data("ajaxy-controller",a).ajaxify({complete:false})});return true},ajaxify_helpers:{a:function(a){var b=c.Ajaxy,d=c(this),e=b.extractRelativeUrl(d.attr("href")).replace(/^\/?\.\//,"/"),f=b.extractState(e);e=b.extractAnchor(e);if("/"+e===f||e===f)e="";var g=!d.hasClass(b.options.no_log_class);d=d.data("ajaxy-controller")||null;b.go({state:f,controller:d,log:g,anchor:e});a.stopPropagation();a.preventDefault();return false},form:function(a){var b=c.Ajaxy,
d=c(this),e=d.attr("disabled");if(e=e||e==="false")return false;if(d.attr("target"))return true;d=b.extractRelativeUrl(d.attr("action")).replace(/^\/?\.\//,"/");d=b.extractState(d);b.go({state:d,form:this});a.stopPropagation();a.preventDefault();return false}}};c.Ajaxy.construct()}})(jQuery);
